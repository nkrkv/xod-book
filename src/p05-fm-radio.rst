
************************
Минималистичное FM-радио
************************

.. image:: TODO.jpg
   :alt: Скетч финального девайса

Итак, наконец-то, к первому проекту! Начнём с чего-нибудь простого, но в то же время условно-полезного. В качестве такого устройства я выбрал настольное FM-радио с классическим управлением двумя поворотными ручками и ЖК-дисплеем для отображения информации.

Вроде бы уже давно настала эра цифрового радио и стриминг-сервисов, но всё равно, порой не хватает аскетичного приёмника, который можно включить одним движением без поиска нужной иконки, без сопряжения с беспроводными колонками, без всей этой суеты. А с учётом того, что вы можете сделать уникальный корпус, можно быть уверенным, что самоделка займёт своё место в интерьере. Поехали!

.. TODO: перечислить фактические знания

В этой главе вы узнаете, как работать с текстовым ЖК-экраном, энкодером и чипом FM-приёмника; что такое шина I²C; как устроено воспроизведение звука; и многое другое.

Необходимое железо
==================

.. TODO: лист картинок

- Ардуино-совместимая плата: Arduino Uno, Iskra Uno, Iskra Nano или другая
- USB-кабель для прошивки и питания
- Модуль FM-приёмника на чипе TEA5767
- Усилитель аудиосигнала, например, на базе микросхемы PAM8403
- Динамик с импедансом 4 или 8 Ом
- Потенциометр для управления громкостью
- Поворотный энкодер для переключения радиостанций
- Текстовый ЖК-экран
- Провода
- Беспаечная макетка (breadboard) для прототипа

Опционально:

- Модуль пауэр-банк для автономной работы
- Тумблер для включения / выключения
- Макетка под пайку для финальной сборки

Как вещает радио
================

Вы конечно знаете, что эфир радиостанций распространяется по-воздуху в виде неких магических невидимых волн. Где-то на радиостанции стоят антенны и оборудование, которые перепаковывают звуковой сигнал в электромагнитный и вещают его во все стороны. Если мы хотим услышать, что происходит в эфире, мы должны этот радиосигнал поймать, распаковать обратно в звуковой вид и отправить на динамик.

Но как это сделать? Нужно разобраться, как устроен FM-сигнал. Итак, по воздуху можно распространять радиоволны. У каждой радиоволны есть *частота*. Эта характеристика говорит о том, сколько раз в секунду встречается пик этой волны. Например, частота в 89.5 мегагерц означает, что пик будет встречаться 89.5 миллионов раз в секунду. Часто, не правда ли? Волны разной частоты можно отделять друг от друга, немного корректируя схему приёмника. Поэтому, на частоте 89.5 МГц сигнал может транслировать одна радиостанция, а на частоте 90.0 Мгц уже другая. При этом они не будут мешать вашему домашнему Wi-Fi, потому что он вовсе работает на частоте около 2.4 или 5 ГГц.

.. image:: TODO.jpg
   :caption: Волны разной частоты формируют эфир

.. note:: А вот сигналы, посылаемые волнами схожих частот очень даже мешают друг другу и это серьёзная проблема современных городов, которая заставляет занимать для разных целей всё новые и новые диапазоны частот. Диапазон частот называется полосой, а разрешают или запрещают их использование разные дядьки в министерствах. Но это уже другая история.

Хорошо, с частотой несущей волны разобрались. Но как с помощью неё передать информацию? В нашем случае звуковой ряд. Тут в дело вступает трюк, который называется модуляцией. Кстати, «FM» означает «фазовая модуляция». Суть трюка заключается в том, чтобы менять фазу несущей частоты в соответствии с тем, какой звуковой сигнал нужно передать: несущую волну сжимают и растягивают как гармошку, чтобы дополнить полезной информацией. Драматично на частоту несущей волны это не влияет, т.к. силы не равны: килогерцы звуковой волны против гигагерц несущей.

.. image:: TODO.jpg
   :caption: Грубая иллюстрация принципа фазовой модуляции

Вроде бы разобрались. Так как имея на руках несколько проводов и пару резисторов, поймать волну и расшифровать её? Можно собрать внушительную схему из отдельных компонентов, как делали наши отцы и деды. Но время идёт и для многих типовых задач давно существуют готовые *микросхемы* (также известные как *чипы*), которые скрывают всю схему под крохотным пластиковым корпусом, а для своей работы требуют минимум дополнить компонентов.

Знакомьтесь, TEA5767!
=====================

Чипом, предназначенным специально для приёма и демодуляции FM-радио является дешёвый и популярный TEA5767. В своём оригинальном виде он предназначен для ширпотребной и миниатюрной электроники, которую производят промышленным образом. Поэтому он настолько мал, что вам, как мейкеру, было бы крайне неудобно работать с ним, если речь идёт о ручной сборке одного или нескольких устройств. К тому же для своей работы он требует несколько дополнителльных компонентов вроде кварцевого резонатора.

Ленивое и алчное человечество не остановилось на создании миниатюрных чипов. Специально для вас, мейкеры, некоторые компании берут такие маленькие чипы, увеличивают их в размерах, распаивая на печатной плате вместе с необходимым обвесом и продают втридорога |emoji_smiling_imp| Но ведь девайс собранный своими руками бесценен, не так ли?!

Для нашего радио нам понадобится один из таких готовых модулей.

.. image:: TODO.jpg
   :caption: Популярные вариации модуля на базе TEA5767

Что же он из себя представляет? Такой модуль является безголовым радио, которым нужно управлять не кнопками и ручками, как на готовой аудио-системе, а командами с конроллера. Контроллером может запросто выступать ваша Arduino-совместимая плата. Контроллер может попросить настроиться на определённую частоту, начать промотку каналов в одну или другую сторону, запросить текст RDS, а в качестве выхода модуль на TEA5767 выдаёт аудиосигнал.

.. image:: TODO.jpg
   :caption: Диаграмма включения модуля FM-приёмника

Давайте теперь разберёмся, как именно общаться с модулем. Такой модуль с точки зрения взаймодействия несколько сложнее, чем светодиод или кнопка: коммуникация с ним строится через так называемый интерфейс I²C. Пусть вас это не пугает: благодаря тому, что для популярных модулей уже созданы библиотеки, работа с ними становится вполне тривиальной.

.. note:: Я надеюсь, что вы не сильно устали, потому что всё написанное выше и под следующим заголовком на деле не нужно для того, чтобы сделать радио |emoji_smile|. Но этими знаниями можно вполне хвастануть за бокалом пива. Сразу после, обещаю, мы приступим к первым этапам сборки.

Интерфейс I²C
=============

